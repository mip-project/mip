# MIP 2.0 的数据和应用

关于 MIP 2.0 的数据设置、绑定，请查看 `mip-bind` 章节，本节将介绍关于数据应用的实践。

## 支持多页共享数据

### 介绍

在 mip2 的环境里，我们提供整站沉浸式的体验，如果要打造复杂的业务场景，页面与页面之间共享数据是必不可少的。在原 `mip-data` 的基础上，mip2 新增了允许整站共享数据的概念

在讲解如何共享之前，我们首先来明晰两个概念：`页面数据(只有当前页面可以访问和使用)` 和 `共享数据(多页面使用)`

### 具体使用方法

1. 设置数据时，如在需要共享的数据前添加 # 标识（仅检测数据第一层），该数据将被提升成共享态：

```javascript
<mip-data>
    <script type="application/json">
        {
            "#globalState": {},
            "pageState": []
        }
     </script>
 </mip-data>
 ```

2. 提升为共享态的数据源将在每个页面都能被读取和使用到：

    **如果**页面使用到了某个数据 a 而页面自身的初始数据源中不存在该数据 a，mip2 将向上查找共享数据；
    **如果**页面自身的初始数据源存在与共享数据冲突的字段

	1. 若页面自身的数据没有 `#` 标识，将优先读取页面数据，不影响共享数据
    2. 若页面自身的数据带有 `#` 标识，将提升为共享数据，覆盖共享数据中同样字段的数据

3. 调用 MIP.setData 方法修改数据时
	1. 如果需要指定修改共享数据，则在数据前添加 `#` 标识，如 `MIP.setData({'#global': 1})`
	2. 其余情况，mip2 会自行判断该数据是共享数据还是当前页面的数据，如果要修改的数据字段既存在于共享也存在于页面的数据源，将优先修改页面的数据源

4. 如果页面中元素用到了共享数据（绑定了共享数据数据或使用 `MIP.watch` 方法观察共享数据），而页面本身没有用 `<mip-data></mip-data>` 来设置初始数据，那么仍需要在页面添加 `mip-data` 的空标签方能正常运行

## Html 页面中使用数据

如 `mip-bind` 章节介绍，在 html 页面中使用数据，可以通过 `m-bind` 或 `m-text` 来绑定数据。

## 组件内使用数据

**mip2 要求开发者以类单向数据流的方式使用数据**

仅允许在 html 页面使用 `m-bind` 来绑定数据，组件内部数据传递以 `props` 的形式传递。组件内部 ***不允许*** 使用 `m-bind` 语法来绑定全局数据。

如果组件内部实现存在自定义标签嵌套的情况，传递数据时 `应` 按照 vue 父子组件的写法来传递数据。

组件内部可以通过调用 `MIP.setData` 来修改全局数据，以此触发重新渲染。

如：

index.html：

```html
<mip-a m-bind:globaldata="globalState"></mip-a>
```

mip-a 组件内部：

```javascript
template: `
    <div>
        <mip-b :globaldata="globaldata"></mip-b>
        <p @click="changeData"></p>
    </div>
`,
props: {
    globaldata: {
        type: Object
    }
},
methods: {
    changeData() {
        MIP.setData({});
    }
}
```
